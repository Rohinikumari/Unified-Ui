<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="en">
<head> 
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="">  
    <title>Node Testing DCG</title>
    <!-- CSS for jquery table -->
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Fileupload CSS
    <link href="css/fileinput.min.css" rel="stylesheet">-->
    <!-- Custom styles for this template -->
    <link href="css/sign.css" rel="stylesheet">
    <link href="css/landing.css" rel="stylesheet">
    <link href="css/datatables.css" rel="stylesheet">
    <link href="css/cgw.css" rel="stylesheet">
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <!--<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet"> -->
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <!--<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css"> -->
  <!--[if lte IE 8]>
  <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]>
  <!-->
   <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/grids-responsive-min.css"> 
   <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
  <!--[if lte IE 8]>
  <link rel="stylesheet" href="css/layouts/marketing-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]>
  <!-->
   <link rel="stylesheet" href="css/marketing.css">
   <link rel="stylesheet" href="css/emqtt.css">
   <!--<![endif]-->
  <!-- <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script> -->
 <style type="text/css">
.form-style-4{
	max-width: 450px;
	margin:10px auto;
	font-size: 16px;
	background: #495C70;
	padding: 30px 30px 15px 30px;
	border: 5px solid #53687E;
}
.form-style-4 input[type=submit],
.form-style-4 input[type=button],
.form-style-4 input[type=text],
.form-style-4 input[type=email],
.form-style-4 textarea,
.form-style-4 label
{
	font-family: Georgia, "Times New Roman", Times, serif;
	font-size: 16px;
	color: #fff;

}
.form-style-4 label {
	display:block;
	margin-bottom: 10px;
}
.form-style-4 label > span{
	display: inline-block;
	float: left;
	width: 150px;
}
.form-style-4 input[type=text],
.form-style-4 input[type=date],
.form-style-4 input[type=datetime],
.form-style-4 input[type=number],
.form-style-4 input[type=search],
.form-style-4 input[type=time],
.form-style-4 input[type=url],
.form-style-4 input[type=email] 
{
	background: transparent;
	border: none;
	border-bottom: 1px dashed #83A4C5;
	width: 275px;
	outline: none;
	padding: 0px 0px 0px 0px;
	
}
.form-style-4 textarea{
	
	padding: 0px 0px 0px 0px;
	background: transparent;
	outline: none;
	border: none;
	border-bottom: 1px dashed #83A4C5;
	width: 275px;
	overflow: hidden;
	resize:none;
	height:20px;
}

.form-style-4 textarea:focus, 
.form-style-4 input[type=text]:focus,
.form-style-4 input[type=date]:focus,
.form-style-4 input[type=datetime]:focus,
.form-style-4 input[type=number]:focus,
.form-style-4 input[type=search]:focus,
.form-style-4 input[type=time]:focus,
.form-style-4 input[type=url]:focus,
.form-style-4 input[type=email]:focus
{
	border-bottom: 1px dashed #D9FFA9;
}

.form-style-4 input[type=submit],
.form-style-4 input[type=button]{
	background: #576E86;
	border: none;
	padding: 8px 10px 8px 10px;
	border-radius: 5px;
	color: #A8BACE;
}
.form-style-4 input[type=submit]:hover,
.form-style-4 input[type=button]:hover{
background: #394D61;
}
</style>
<script type="text/javascript">
function adjust_textarea(h) {
    h.style.height = "20px";
    h.style.height = (h.scrollHeight)+"px";
}
</script>
</head>
<style>
#demo {
    text-align: right;
    color: white;
}
</style>
<body class="landing-body">
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
 <p class="logo"><a href="http://13.250.24.178:3500/login.html"><button onclick="removeData();"><img align = "left" alt="" src = "/img/logout.png" height = "15" width = "15"></button>
</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unified UI</p><p id="demo"></p>
        </div>
        <div class="navbar-collapse navbar-ex1-collapse collapse" style="height: 1px;">
           <ul class="nav nav-sidebar navbar-inverse side-nav">
	    <div class="scroll">	        
             
	   <div class="dropdown">
		<button onclick="myFunction()" class="dropbtn">STANDARD DEVICE CLOUD GATEWAY</button>
		<div id="myDropdown" class="dropdown-content">
		<a href="CloudProvisioning.html">Cloud Provisioning</a>
		<a href="solutionProvisioning.html">Solution Provisioning</a>
		<a href="DeviceProvisioningOrInventory.html">Device Provisioning/Inventory</a>
		<a href="localtestdemo.html">Local Operation (EMQTT)</a>
		<a href="remoteoperationdemo.html">Remote Operation (DCG)</a>
                <a href="registrationGateway.html">Registration via API Gateway</a>
		<a href="registration.html">Direct Standard Gateway Registration</a>
		<br>		
		<div class="dropdown2">		
		<button onclick="myFunction2()" class="dropbtn2">PONTE APPS</button>
                <div id="myDropdown2" class="dropdown2-content">
		<a href="PartnerTesting.html">Admin Testing with Ponte</a>
		<a href="operatorTesting.html">Operator Testing with Ponte</a>
		<a href="solutionTesting.html">Solution Testing with Ponte</a>
		<a href="Solution&NodeTesting.html">Solution and Node Testing with Ponte</a>
		<a href="NodeTesting.html">Nodes Testing with Ponte</a>
		</div>
		</div>
                <div class="dropdown11">
		<button onclick="location.href=''" class="dropbtn11">TCP/IP ADAPTER APPS</button>
                <div id="myDropdown11" class="dropdown11-content">
		</div>
		</div>		
		</div> 
		</div>
		<br>
		<br>
		<div class="dropdown22">
		<button onclick="myFunction22()" class="dropbtn22">SOL DEVELOPMENT(AUTH CODE)</button>
                <div id="myDropdown22" class="dropdown22-content">
		<a href="webAppAccessWithoutSecretKey.html">MOBILE WEB APP ACCESS WITHOUT SECRET KEY</a>
		<a href="webAppAccessWithSecretKey.html">MOBILE WEB APP ACCESS WITH SECRET KEY</a>
		<a href="mobilewebappCreationandAccessGrant.html">MOBILE WEB APP CREATION AND TESTING (AUTH GRANT FLOW)</a>
		<div class="dropdown24">
		<button onclick="myFunction24()" class="dropbtn24">MOBILE NATIVE APP</button>
                <div id="myDropdown24" class="dropdown24-content">
		<a href="">Get Authorization Code</a>	
		<a href="">Get Access Token</a>	
		<a href="">Call Other Api's For Mobile App Development</a>	
		</div>
		</div>
		<div class="dropdown19">
		<button onclick="myFunction19()" class="dropbtn19">MOBILE HYBRID APP</button>
                <div id="myDropdown19" class="dropdown19-content">
		<a href="deviceRegister.html">Device Registration</a>
		<a href="appRegister.html">App Registration</a>
		<a href="appSolActivation.html">App/Solution Activation</a>
		<a href="getAuthorizationCode.html">Get Authorization Code</a>	
		<a href="getAccessToken.html">Get Access Token</a>	
		<a href="mobilewebsite.html">Create Mobile Website</a>
		<a href="accessCreatedMobileWebsite.html">Access Created Mobile Website</a>
		</div>
		</div>
		</div>
		</div>
		<br>
		<br>
		<div class="dropdown26">
		<button onclick="myFunction26()" class="dropbtn26">SOL DEVELOPMENT(IMPLICIT)</button>
                <div id="myDropdown26" class="dropdown26-content">
		<a href="mobilewebappImplicit.html">MOBILE WEB APP CREATION AND TESTING (IMPLICIT)</a>	
		</div>
		</div>
		<br>
		<br>
		<div class="dropdown20">
		<button onclick="myFunction20()" class="dropbtn20">MY RESOURCES</button>
                <div id="myDropdown20" class="dropdown20-content">
		<a href="mySolutions.html">My Solutions</a>	
		<a href="mysites.html">My Sites</a>	
		<a href="mydevices.html">My Devices</a>	
		</div>
		</div>
		<br>
		<br>		
		<div class="dropdown9">
		<button onclick="myFunction9()" class="dropbtn9">ONE M2M SERVICE</button>
                <div id="myDropdown9" class="dropdown9-content">
		<div class="dropdown6">
		<button onclick="myFunction6()" class="dropbtn6">DCG APPS</button>
                <div id="myDropdown6" class="dropdown6-content">
		<a href="partnerTestingDCG.html">Admin Testing with DCG</a>
                <a href="operatorTestingDCG.html">Operator Testing with DCG</a>
		<a href="solutionTestingDCG.html">Solution Testing with DCG</a>
		<a href="solution&nodesTestingDCG.html">Solution and Nodes Testing with DCG</a>
		<a href="nodesTestingDCG.html">Node Testing with DCG</a>
		</div>
		</div>
		<div class="dropdown10">
		<button onclick="myFunction10()" class="dropbtn10">OTA</button>
                <div id="myDropdown10" class="dropdown10-content">
		<a href="">Firmware pending update</a>
		<a href="">Software pending update</a>
               	</div>
		</div>
		<div class="dropdown8">
		<button onclick="myFunction8()" class="dropbtn8">SDP</button>
                <div id="myDropdown8" class="dropdown8-content">
		</div>
		</div>
		</div>
		<br>
		<br>		
		<div class="dropdown16">
		<button onclick="myFunction16()" class="dropbtn16">SITE INSTALLER</button>
                <div id="myDropdown16" class="dropdown16-content">
		<a href="spot.html">Spot</a>
		<a href="lot.html">Lot</a>
		<a href="remoteaccessvalidation.html">Remote Access Validation</a>
		</div>
		</div>
		<br>
		<br>
	        <div class="dropdown3">
		<button onclick="myFunction3()" class="dropbtn3">APP</button>
                <div id="myDropdown3" class="dropdown3-content">
		<a href="app.html">All Categories & Content</a>
		</div>
		</div>
		<br>
		<br>
		</div>
	    </ul>
        </div>
    </div>
</div>
<script src="js/cgw.js"></script>
<div class="container-fluid" id="wrapper" data-platform=''>   
</div>
<div id="output"></div>
       <center>  
                        <div id="page">
			<div id="content">
			<div class="border"></div>
			<div class="main" id="form-elem-section" style="width: 100%">
			<p class="p" align="center">
			<form name="f1" id="f1" class="form-style-4" action="" method="post">
			<font size = "5" color="white">NODES TESTING WITH DCG</font>					
			</p><br><br><br>
			<input type="hidden" value="11" name="src">	
			<label for="field1">
			<span>Partner Id</span><input type="text" name="partnerid" id="partnerid" required="true" />
			</label>				
			<label>
			<span>&nbsp;</span><input type="submit" onclick="getnodesList()" value="Submit" />
			</label>
                       <table border="1" color=" #576E86" width="85%" cellpadding="10">								
			<label for="field1">
			<span>Node List</span>
                        <tr>
			<td id ="msg"></td>
			</tr>	</label>				
			</table>
	                <table border="1" color=" #576E86" width="85%" cellpadding="10">								
			<label for="field2">
			<span>Connection Status</span>
			<tr>
			<td id ="cs"></td>
			</tr>	</label>			                                             			
			</table>
	                <table border="1" color=" #576E86" width="85%" cellpadding="10">								
			<label for="field3">
			<span>Payload Status</span>
			<tr>
			<td id ="pl"></td>
			</tr>	</label>			                                             			
			</table>
			<table border="1" color=" #576E86" width="85%" cellpadding="10">								
			<label for="field3">
			<span>Battery Status</span>
			<tr>
			<td id ="bs"></td>
			</tr>	</label>			                                             			
			</table>		
			</form>
                        </div> 
<div class="ribbon l-box-lrg pure-g">
      <div class="l-box-lrg pure-u-2-3">
        <button class="pure-button btn-clear">message clear</button>
        <div class="messages"></div>
      </div>

      <div class="pure-u-1-3">

        <form class="pure-form">
          <fieldset>
            <legend>Connect / Disconnect</legend>
            <button class="pure-button btn-connect">connect</button>
            <button class="pure-button btn-disconnect">disconnect</button>
          </fieldset>
		  
          <fieldset>
            <legend></legend>
            <label>
			  Address:
              <input type="text" class="input-broker-ws" value="http://52.89.109.174:3000"></label>
          </fieldset>

          <fieldset>
            <legend>Subscribe / Unsubscribe</legend>
            <label>
              Topic:
              <input type="text" class="input-topic-sub" value="PARTNER/#/#"></label>
            <button class="pure-button btn-subscribe">subscribe</button>
            <button class="pure-button btn-unsubscribe">unsubscribe</button>
          </fieldset>

          <fieldset>
            <legend>Publish</legend>
            <label>
              Topic:
              <input type="text" class="input-topic-pub" value="PARTNER/#/SOLUTION/#/NODE/#/ST"></label>
            <label>
              Message:
              <input type="text" class="input-message" value="nId=12=nT=SOLUTION&NODE=status=1"></label>
            <button class="pure-button btn-publish">publish</button>
          </fieldset>
        </form>
      </div>
    </div> 			
 
   <script src="js/indexlogin.js"></script>
   <div class="footer">
        <div class="">
        <p class=""> &copy; 2016 U-NaaS. All rights reserved</p>
        </div> </div>
   <script src="js/mows.js"></script>
  <script src="js/main.js"></script>  
  <script>
   function removeData(){
	
	console.log("inside remove data");
	localStorage.removeItem('realm');	
	localStorage.removeItem('accessToken');
	localStorage.removeItem('userId');
     }
        var usrid = localStorage.getItem('userId');
	console.log("userId.... " +usrid);
	document.getElementById("demo").innerHTML = usrid;
  </script>  
    </center>
<script>
	// Create a new WebSocket
	var nodeEvent = new WebSocket('ws://35.164.253.193:4000/devctrl/devices/event');   // cs, bs, ack
	var nodeLive = new WebSocket('ws://35.164.253.193:4000/devctrl/devices/live');   // pl
        var nodeId;
	var status;
	var nodetype;
	var batteryst;
	var payloadst;
	// Handle messages sent by the server (cs, bs)
	nodeEvent.onmessage = function(event) {
	 var message = event.data;
	 console.log("nodeEvent message... "+message);
	 var obj  = jQuery.parseJSON(message);
	 var dt   = JSON.parse(obj);
	 var keys =  Object.keys(dt);	 
	 var key = (keys.toString()).split(",");
	 var messagetype = key[2];
	 console.log("message type ......     "+messagetype);
	 if(messagetype == "connectionStatus"){
	   nodeId   = dt.nId;
	   nodetype  = dt.nT;
	   status   = dt.connectionStatus.status;
	   console.log("node Id.... "+nodeId);
	   console.log("node type.... "+nodetype);
	   console.log("connection status.... "+status);
	 }else if(messagetype == "batteryStatus"){
	   nodeId   = dt.nId;
	   nodetype  = dt.nT;
	   batteryst   = dt.batteryStatus.status;
	   console.log("node Id.... "+nodeId);
	   console.log("node type.... "+nodetype);
	   console.log("battery status.... "+batteryst);
	 }else{
	 console.log("topic type not supported (event).... ");
	 }	 
	};
        
	// Handle messages sent by the server (pl)
	nodeLive.onmessage = function(event) {
	 var message = event.data;
	 console.log("nodeLive message... "+message);
	 var msg = message.replace('/',' ');
	 console.log("msg@@@@@@.... "+msg);
	 //var obj = jQuery.parseJSON(msg);
	 //var dt = JSON.parse(obj);
	 //console.log("dt.... "+dt);
	 nodeId   = dt.devId;
	 nodetype  = dt.sensor;
	 payloadst   = dt.status.SensorValue;
	 console.log("node Id.... "+nodeId);
	 console.log("node type.... "+nodetype);
	 console.log("status.... "+payloadst);         
	};

	// Show a disconnected message when the WebSocket is closed
	nodeEvent .onclose = function(event) {
	  console.log("nodeEvent webscoket close... ");

	};

	// Show a disconnected message when the WebSocket is closed
	nodeLive.onclose = function(event) {
	console.log("nodeLive webscoket close... ");

	};
	
	var baseSolList ="http://54.254.214.241:8080/DMBackEndGw/DMDevice/";
	var realm = localStorage.getItem('realm');         // getting realm from web storage (local storage)
	var token = localStorage.getItem('accessToken');  // getting access token from web storage (local storage)
	
		
	// get nodes list
	function getnodesList() {	                
				
			var paid=document.f1.partnerid.value;
			document.getElementById('partnerid').innerHTML=paid;
			
                       	$.ajax({		
			type : "GET",					
			url : baseSolList+"getDevices/"+realm+"/"+paid,
			contentType : "application/json; charset=utf-8",
			crossDomain : true,
			processData : false,
		        headers: {
				'Authorization': 'Bearer '+token
			},
			})
			.done(
			function(json) {
			var jsonData = JSON.stringify(json);
			var value = "<table>";			
			var json2       = JSON.parse(jsonData);
			for(i = 0; i<json2.devices.length; i++){			
			var deviceUdn = json2.devices[i].udn;
						console.log("Device Udn ====> : " + deviceUdn);
						value += "<tr>"						
						+"<td align='center'><a href='#' onclick=getConnectionStatus('"+deviceUdn+"');>"+deviceUdn+"</a></td>"; 
						+"</tr>";						
		        }
			value +="</table>";						
			console.log("value value ====> : " + value);
			document.getElementById("msg").innerHTML = value;
			}).error(function() {
			console.log("Status Error Occured");
			}).complete(function() {
			});}
			
	function getConnectionStatus(deviceUdn){
	                if(deviceUdn === nodeId){			
		     	var valueSol = "<table>";			
			valueSol += "<tr>"						
			+"<td align='left' style='color:#F08D0E'>"+deviceUdn+"--"+nodetype+"--"+status+"</a></td>";
			+"</tr>";
			valueSol +="</table>";						
			console.log("valueSol value ====> : " + valueSol);
			document.getElementById("cs").innerHTML = valueSol;
			getpayloadStatus(deviceUdn);
                        }else{
			console.log("no data received in cs.... ");
			}			
	}
	function getpayloadStatus(deviceUdn){
	                if(deviceUdn === nodeId){
			var valueSol = "<table>";			
			valueSol += "<tr>"						
			+"<td align='left' style='color:#F08D0E'>"+nodeId+"--"+nodetype+"--"+status+"</a></td>";
			+"</tr>";
			valueSol +="</table>";						
			console.log("valueSol value ====> : " + valueSol);
			document.getElementById("pl").innerHTML = valueSol;
			getbatteryStatus(deviceUdn);
                        }else{
			console.log("no data received in pl.... ");
			}			
	}
	
	function getbatteryStatus(deviceUdn){
	                if(deviceUdn === nodeId){
			var valueSol = "<table>";			
			valueSol += "<tr>"						
			+"<td align='left' style='color:#F08D0E'>"+nodeId+"--"+nodetype+"--"+batteryst+"</a></td>";
			+"</tr>";
			valueSol +="</table>";						
			console.log("valueSol value ====> : " + valueSol);
			document.getElementById("bs").innerHTML = valueSol;
                        }else{
			console.log("no data received in bs.... ");
			}			
	}

</script>
</body>
</html>